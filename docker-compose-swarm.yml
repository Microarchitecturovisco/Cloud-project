version: "3.9"

services:

  # config:
  #   image: cloud-project-config
  #   ports:
  #     - "8012:8012"
  #   networks:
  #     - cloud-backend-swarm
  #   env_file:
  #     - .env
  #   healthcheck:
  #     test: "curl --fail --silent localhost:8012/actuator/health | grep UP || exit 1"
  #     interval: 5s
  #     timeout: 5s
  #     retries: 10

  # discovery:
  #   image: cloud-project-discovery
  #   hostname: discovery
  #   ports:
  #     - "8089:8089"
  #   networks:
  #     - cloud-backend-swarm
  #   healthcheck:
  #     test: "curl --fail --silent localhost:8089/actuator/health | grep UP || exit 1"
  #     interval: 5s
  #     timeout: 5s
  #     retries: 10

  api-gateway:
    image: cloud-project-api-gateway
    depends_on:
      - discovery
      - config
    ports:
      - "8088:8088"
    networks:
      - cloud-backend-swarm
    deploy:
      replicas: 1

  travel:
    image: cloud-project-travel
    depends_on:
      - discovery
      - config
    networks:
      - cloud-backend-swarm
    deploy:
      replicas: 2

  user:
    image: cloud-project-user
    depends_on:
      - discovery
      - config
    expose:
      - "8869"
    networks:
      - cloud-backend-swarm
    deploy:
      replicas: 2

networks:
  cloud-backend-swarm:
